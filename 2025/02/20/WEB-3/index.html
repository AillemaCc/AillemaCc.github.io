<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>WEB-3 | AllimacBlog</title><meta name="author" content="Allimac"><meta name="copyright" content="Allimac"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="会话管理&amp;会话跟踪">
<meta property="og:type" content="article">
<meta property="og:title" content="WEB-3">
<meta property="og:url" content="http://example.com/2025/02/20/WEB-3/index.html">
<meta property="og:site_name" content="AllimacBlog">
<meta property="og:description" content="会话管理&amp;会话跟踪">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s21.ax1x.com/2025/02/20/pEQs4HJ.jpg">
<meta property="article:published_time" content="2025-02-20T12:27:08.000Z">
<meta property="article:modified_time" content="2025-02-22T07:03:31.302Z">
<meta property="article:author" content="Allimac">
<meta property="article:tag" content="Servlet">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s21.ax1x.com/2025/02/20/pEQs4HJ.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "WEB-3",
  "url": "http://example.com/2025/02/20/WEB-3/",
  "image": "https://s21.ax1x.com/2025/02/20/pEQs4HJ.jpg",
  "datePublished": "2025-02-20T12:27:08.000Z",
  "dateModified": "2025-02-22T07:03:31.302Z",
  "author": [
    {
      "@type": "Person",
      "name": "Allimac",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/faviconcute.png"><link rel="canonical" href="http://example.com/2025/02/20/WEB-3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'WEB-3',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s21.ax1x.com/2025/02/20/pEQs4HJ.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">AllimacBlog</span></a><a class="nav-page-title" href="/"><span class="site-name">WEB-3</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">WEB-3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-20T12:27:08.000Z" title="发表于 2025-02-20 20:27:08">2025-02-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-02-22T07:03:31.302Z" title="更新于 2025-02-22 15:03:31">2025-02-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/JAVA/">JAVA</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="会话管理的概念和基本原理"><a href="#会话管理的概念和基本原理" class="headerlink" title="会话管理的概念和基本原理"></a>会话管理的概念和基本原理</h1><h2 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h2><p>对于简单的页面浏览或者信息获取，HTTP协议即可胜任。比如浏览资讯或者查看表单。然而对于需要客户端和服务器端的多次交互的网络应用，我们就必须在一定程度上，记住客户端状态。比如用户是否登录，用户存储的购物车等等。这时候就需要会话管理</p>
<h2 id="简单的定义"><a href="#简单的定义" class="headerlink" title="简单的定义"></a>简单的定义</h2><p>很官方的定义大概长这样</p>
<blockquote>
<p>会话管理是指用于跟踪用户与应用程序或网站之间互动的一种机制。由于HTTP协议是无状态的，即每个请求都是独立的，不会自动保存状态和上下文信息，因此会话管理对于维持用户状态至关重要。会话管理通过创建、维护和销毁会话来实现用户状态的跟踪和保持。</p>
</blockquote>
<p>在我们日常生活当中，会话指的就是谈话、交谈。</p>
<p>在web开发当中，会话指的就是浏览器与服务器之间的一次连接，我们就称为一次会话</p>
<p>在用户打开浏览器第一次访问服务器的时候，这个会话就建立了，直到有任何一方断开连接，此时会话就结束了。在一次会话当中，是可以包含多次请求和响应的。</p>
<p>比如：打开了浏览器来访问web服务器上的资源（浏览器不能关闭、服务器不能断开）</p>
<pre><code>第1次：访问的是登录的接口，完成登录操作
第2次：访问的是部门管理接口，查询所有部门数据
第3次：访问的是员工管理接口，查询员工数据
</code></pre>
<p>只要浏览器和服务器都没有关闭，以上3次请求都属于一次会话当中完成的。</p>
<p>会话是和浏览器关联的，当有三个浏览器客户端和服务器建立了连接时，就会有三个会话。同一个浏览器在未关闭之前请求了多次服务器，这多次请求是属于同一个会话。比如：1、2、3这三个请求都是属于同一个会话。当我们关闭浏览器之后，这次会话就结束了。而如果我们是直接把web服务器关了，那么所有的会话就都结束了。</p>
<h2 id="怎么实现呢"><a href="#怎么实现呢" class="headerlink" title="怎么实现呢"></a>怎么实现呢</h2><p>会话管理的核心原理是为每个用户会话分配一个唯一的标识符（如Session ID），并在多个请求之间使用该标识符来识别用户并恢复其状态。</p>
<h2 id="会话跟踪"><a href="#会话跟踪" class="headerlink" title="会话跟踪"></a>会话跟踪</h2><p>在这之后，我们需要一种新技术，来展现服务器需要识别多次请求是否来自于同一浏览器，以便在同一次会话的多次请求间共享数据。</p>
<blockquote>
<p>服务器会接收很多的请求，但是服务器是需要识别出这些请求是不是同一个浏览器发出来的。比如：1和2这两个请求是不是同一个浏览器发出来的，3和5这两个请求不是同一个浏览器发出来的。如果是同一个浏览器发出来的，就说明是同一个会话。如果是不同的浏览器发出来的，就说明是不同的会话。而识别多次请求是否来自于同一浏览器的过程，我们就称为会话跟踪。</p>
</blockquote>
<blockquote>
<p>为什么要共享数据呢？</p>
<p>由于HTTP是无状态协议，在后面请求中怎么拿到前一次请求生成的数据呢？此时就需要在一次会话的多次请求之间进行数据共享</p>
</blockquote>
<p>尽管这次实验的标题是会话管理，但是核心还是会话跟踪的方法</p>
<h1 id="四种跟踪客户的状态方法"><a href="#四种跟踪客户的状态方法" class="headerlink" title="四种跟踪客户的状态方法"></a>四种跟踪客户的状态方法</h1><h2 id="HttpSession"><a href="#HttpSession" class="headerlink" title="HttpSession"></a>HttpSession</h2><p>服务器端技术；将用户的状态信息保存在服务器上，通过唯一的sessionid，来关联特定用户。这基本上代表用户和web服务器的一次会话</p>
<h3 id="创建和绑定过程"><a href="#创建和绑定过程" class="headerlink" title="创建和绑定过程"></a>创建和绑定过程</h3><p>当用户首次请求服务器时，服务器会创建一个<strong>HttpSession</strong>对象，并生成一个<strong>SessionID</strong>。这个<strong>SessionID</strong>会被存储在<strong>Cookie</strong>中，并发送给客户端浏览器。浏览器会将这个<strong>Cookie</strong>保存在缓存中，只要浏览器没有关闭，这个<strong>Cookie</strong>就会存在。在后续的请求中，浏览器会自动提交这个<strong>Cookie</strong>，服务器通过<strong>Cookie</strong>中的<strong>SessionID</strong>在<strong>session列表</strong>中检索对应的<strong>HttpSession</strong>对象。</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p><strong>HttpSession</strong>的生命周期并不是由浏览器的关闭来决定的。即使浏览器关闭了，服务器端的<strong>HttpSession</strong>对象仍然存在，直到超时。默认情况下，如果一段时间内没有用户访问<strong>HttpSession</strong>对象，它会超时，默认超时时间是30分钟，但可以在<strong>web.xml</strong>中配置。</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p><strong>HttpSession</strong>可以用来存储用户专属的数据，如购物车信息。在JavaWeb中，可以通过<em>request.getSession()<em>方法获取当前的<strong>HttpSession</strong>对象，并使用</em>setAttribute</em>、<em>getAttribute</em>、<em>removeAttribute</em>等方法来操作会话中的数据。例如，用户登录成功后，可以将用户的登录状态保存在<strong>HttpSession</strong>中，而不是<strong>request</strong>或<strong>application</strong>范围中，因为登录状态是会话级别的，不应该被所有用户共享。</p>
<h3 id="范围对象"><a href="#范围对象" class="headerlink" title="范围对象"></a>范围对象</h3><p><strong>HttpSession</strong>与<strong>ServletContext</strong>（应用范围）和<strong>HttpServletRequest</strong>（请求范围）是JavaWeb中的三个范围对象。它们都可以用来传递数据，但是存储的数据范围和生命周期不同。<strong>ServletContext</strong>是所有用户共享的空间，适合存储所有用户共享的、不会被修改的数据。<strong>HttpServletRequest</strong>是请求级别的对象，适合存储请求级别的、一次请求后不再使用的数据。而<strong>HttpSession</strong>则是会话级别的，适合存储用户专属的数据。</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>我们都非常熟悉，饼干</p>
<p>名字源自一种叫 Fortune cookie 的饼干，这种饼干里面有一张写着精辟句子的小纸条。</p>
<p>在浏览器中，Cookie 是服务器让浏览器帮忙携带信息的手段，就像饼干里的纸条，<strong>浏览器会储存它，并且在后续的 HTTP 请求中再次发送给服务器</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie` 最开始被设计出来是为了弥补`HTTP`在**状态管理上的不足**。`HTTP` 协议是一个无状态协议，客户端向服务器发请求，服务器返回响应，故事就这样结束了，但是下次发请求如何让服务端知道客户端是谁呢？这种背景下，就产生了 `Cookie。</span><br></pre></td></tr></table></figure>

<p>这是客户端上的技术；</p>
<blockquote>
<p>HTTP Cookie（也叫 Web Cookie 或浏览器 Cookie）是服务器发送到用户浏览器并保存在本地的一小块数据。浏览器会存储  cookie  并在下次向同一服务器再发起请求时携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器——如保持用户的登录状态。Cookie  使基于<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview#http_%E6%98%AF%E6%97%A0%E7%8A%B6%E6%80%81%EF%BC%8C%E6%9C%89%E4%BC%9A%E8%AF%9D%E7%9A%84">无状态</a>的 HTTP 协议记录稳定的状态信息成为了可能。</p>
</blockquote>
<p>cookie可以用于会话状态管理，个性化设置存储等等</p>
<p>Cookie 曾一度用于客户端数据的存储，因当时并没有其他合适的存储办法而作为唯一的存储手段，但现在推荐使用现代存储 API。由于服务器指定  Cookie 后，浏览器的每次请求都会携带 Cookie 数据，会带来额外的性能开销（尤其是在移动环境下）。新的浏览器 API  已经允许开发者直接将数据存储到本地，如使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API">Web storage API</a>（<code>localStorage</code> 和 <code>sessionStorage</code>）或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">IndexedDB</a> 。</p>
<p>csdn现在就用indexedDB</p>
<h3 id="创建cookie"><a href="#创建cookie" class="headerlink" title="创建cookie"></a>创建cookie</h3><p>大概分为这么几个流程：</p>
<ul>
<li>服务器收到HTTP请求，发现浏览器发送的请求当中没有携带cookie</li>
<li>服务器发现之后，会在响应头里面添加set-cookie选项</li>
<li>浏览器收到set-cookie请求之后，就会将cookie保存</li>
<li>下次访问这个网站&#x2F;服务器 HTTP请求头就会携带着这个cookie</li>
</ul>
<h3 id="cookie结构"><a href="#cookie结构" class="headerlink" title="cookie结构"></a>cookie结构</h3><p>name-value</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: &quot;name=value;domain=.domain.com;path=/;expires=Sat, 11 Jun 2016 11:29:42 GMT;HttpOnly;secure&quot;</span><br></pre></td></tr></table></figure>

<p>例如name&#x3D;jack，这个就表示cookie的名字是name，cookie携带的值是jack。</p>
<p>基本来说，简单的cookie可能像这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: <span class="tag">&lt;<span class="name">cookie-name</span>&gt;</span>=<span class="tag">&lt;<span class="name">cookie-value</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这指示服务器发送标头告知客户端存储一对 cookie：</p>
<p>服务器返回的响应可能像这样：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.0</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>yummy_cookie=choco</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>tasty_cookie=strawberry</span><br><span class="line"></span><br><span class="line"><span class="language-angelscript"><span class="string">[页面内容]</span></span></span><br></pre></td></tr></table></figure>

<p>现在，对该服务器发起的每一次新请求，浏览器都会将之前保存的 Cookie 信息通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cookie"><code>Cookie</code></a> 请求头部再发送给服务器。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/sample_page.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.example.org</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>yummy_cookie=choco; tasty_cookie=strawberry</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="生命周期-1"><a href="#生命周期-1" class="headerlink" title="生命周期"></a>生命周期</h3><ul>
<li><em>会话期</em> Cookie 会在当前的会话结束之后删除。浏览器定义了“当前会话”结束的时间，一些浏览器重启时会使用<em>会话恢复</em>。这可能导致会话 cookie 无限延长。</li>
<li><em>持久性</em> Cookie 在过期时间（<code>Expires</code>）指定的日期或有效期（<code>Max-Age</code>）指定的一段时间后被删除。</li>
</ul>
<p>cookie默认的有效期很短暂，它只能维持在Web浏览器的会话期间，一旦用户关闭浏览器，cookie保存的数据就丢失了。要注意的是，这与sessionStorage的有效期还是有区别的：cookie的作用域不是局限在浏览器的单个窗口中，它的有效期和整个浏览器进程而不是单个浏览器窗口的有效期一致。如果想要延长cookie的有效期，可以通过设置max-age属性。一旦设置了有效期，浏览器就会将cookie数据存储在一个文件中，并且直到过了指定的有效期才会删除该文件。</p>
<h3 id="domain和path"><a href="#domain和path" class="headerlink" title="domain和path"></a>domain和path</h3><p>cookie的作用域是通过文档源和文档路径来确定的。该作用域通过cookie的path和domain属性可配置。</p>
<p>domain：</p>
<p>Cokie生效的域名，即Cookie在哪个网站生效。默认当前访问域名。</p>
<p>例如我们在a.jzplp.com下设置的Cookie，就只在这个域名下生效。但是如果我们设置了domain&#x3D;jzplp.com，则该Cookie可以在jzplp.com下的任何域名内生效。比如：jzplp.com，a.jzplp.com, b.jzplp.com。</p>
<p>domain 只能设置为当前服务器的域。</p>
<p>path：</p>
<p>有时候，我们希望Cookie仅仅在部分路径下生效，就可以使用Path进行限制。这里的路径就是网站的路由。默认的path&#x3D;&#x2F;，即在所有路径下生效。 如果设置了path&#x3D;&#x2F;abc，则只在&#x2F;abc路径下生效。比如：</p>
<pre><code>jzplp.com 不生效
jzplp.com/abc 生效
jzplp.com/abc/def 生效
jzplp.com/qaz 不生效
jzplp.com/qaz/abc 不生效
</code></pre>
<h3 id="一场例子"><a href="#一场例子" class="headerlink" title="一场例子"></a>一场例子</h3><p>以用户登录-退出登陆为例，Cookie 的生命周期如下：</p>
<p>前端通过用户登录 API 向后端传递用户信息，后端核对与数据库信息是否匹配。</p>
<p>匹配后<strong>在登录 API 返回头部 <code>set-cookie</code> 返回记录用户状态的 cookie 值 userToken：</strong></p>
<p>浏览器按照 <code>set-cookie</code> 的规则解析后存入浏览器</p>
<p><strong>后续浏览器会自动将 userToken 加到满足条件（域名、路径）的 API 的 请求头部 cookie 中</strong></p>
<p>如果退出登陆，返回头部的 <code>set-cookie</code> 会拜托浏览器帮忙删除 userToken，浏览器的 cookie 储存库就会将 userToken 字段删除，后续的 API 请求头部 <code>cookie</code> 也不会发送它</p>
<h2 id="url重写机制"><a href="#url重写机制" class="headerlink" title="url重写机制"></a>url重写机制</h2><p>当程序需要为某个客户端的请求创建一个session时，服务器首先检查这个客户端的请求里是否已包含了一个session标识（称为session id），如果已包含则说明以前已经为此客户端创建过session，服务器就按照session  id把这个session检索出来使用（检索不到，会新建一个），如果客户端请求不包含session  id，则为此客户端创建一个session并且生成一个与此session相关联的session id，session  id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个session id将被在本次响应中返回给客户端保存。</p>
<p>保存这个session  id的方式可以采用cookie，这样在交互过程中浏览器可以自动的按照规则把这个标识发挥给服务器。一般这个cookie的名字都是类似于SEEESIONID。但cookie可以被人为的禁止，则必须有其他机制以便在cookie被禁止时仍然能够把session id传递回服务器。</p>
<p>经常被使用的一种技术叫做URL重写，就是把session id直接附加在URL路径的后面。还有一种技术叫做表单隐藏字段。就是服务器会自动修改表单，添加一个隐藏字段，以便在表单提交时能够把session id传递回服务器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/example&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 检查是否需要进行URL重写</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedUrl</span> <span class="operator">=</span> response.encodeURL(<span class="string">&quot;http://example.com/anotherPage&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出带有会话ID的链接</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;html&gt;&lt;body&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;a href=&#x27;&quot;</span> + encodedUrl + <span class="string">&quot;&#x27;&gt;Go to Another Page&lt;/a&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 处理POST请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong><code>response.encodeURL(&quot;http://example.com/anotherPage&quot;)</code></strong>：</p>
<ul>
<li>这行代码的作用是调用 <code>HttpServletResponse</code> 对象的 <code>encodeURL()</code> 方法，并传入目标URL <code>&quot;http://example.com/anotherPage&quot;</code>。</li>
<li><code>encodeURL()</code> 方法会根据当前会话的状态决定是否需要在URL中添加会话ID。</li>
</ul>
<p><strong>如果客户端支持Cookie</strong>：</p>
<ul>
<li>假设客户端支持并启用了Cookie，<code>encodeURL()</code> 方法将直接返回原始的URL字符串 <code>&quot;http://example.com/anotherPage&quot;</code>，因为会话信息可以通过Cookie传递，不需要在URL中附加会话ID。</li>
</ul>
<p><strong>如果客户端不支持Cookie</strong>：</p>
<ul>
<li><p>如果客户端不支持或禁用了Cookie，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">encodeURL()</span><br></pre></td></tr></table></figure>

<p>方法会在URL中添加会话ID参数。例如，假设当前会话ID为 </p>
<p>1234567890abcde</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/anotherPage;jsessionid=1234567890abcdef</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http://example.com/anotherPage?jsessionid=1234567890abcdef</span><br></pre></td></tr></table></figure>

<p>具体格式取决于URL的路径部分是否有查询参数。</p>
</blockquote>
<h2 id="使用隐藏的表单域"><a href="#使用隐藏的表单域" class="headerlink" title="使用隐藏的表单域"></a>使用隐藏的表单域</h2><p>隐藏的表单域（Hidden Form Fields）是一种在HTML表单中嵌入不可见字段的技术，用于在提交表单时传递额外的数据。这些数据不会显示给用户，但会在表单提交时随其他表单数据一起发送到服务器。隐藏表单域常用于以下场景：</p>
<ol>
<li><strong>会话跟踪</strong>：在不支持或禁用Cookie的情况下，可以通过隐藏表单域传递会话ID。</li>
<li><strong>状态维护</strong>：保存某些临时状态信息，如页面跳转前的状态、步骤编号等。</li>
<li><strong>安全性增强</strong>：防止跨站请求伪造（CSRF）攻击，通过在隐藏字段中包含一次性令牌（Token）。</li>
</ol>
<h3 id="隐藏表单域的基本结构"><a href="#隐藏表单域的基本结构" class="headerlink" title="隐藏表单域的基本结构"></a>隐藏表单域的基本结构</h3><p>隐藏表单域使用 <code>&lt;input&gt;</code> 标签，并设置 <code>type=&quot;hidden&quot;</code> 属性。以下是基本结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/submit&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sessionId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1234567890abcdef&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 其他表单元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>sessionId</code> 是一个隐藏表单域，其值为 <code>1234567890abcdef</code>。当用户提交表单时，这个隐藏字段的值也会被发送到服务器。</p>
<h3 id="使用隐藏表单域的示例"><a href="#使用隐藏表单域的示例" class="headerlink" title="使用隐藏表单域的示例"></a>使用隐藏表单域的示例</h3><h4 id="示例1：会话跟踪"><a href="#示例1：会话跟踪" class="headerlink" title="示例1：会话跟踪"></a>示例1：会话跟踪</h4><p>假设我们有一个多步表单，需要在每一步之间传递会话ID以保持用户的会话状态。</p>
<h5 id="第一步表单："><a href="#第一步表单：" class="headerlink" title="第一步表单："></a>第一步表单：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/step2&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sessionId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1234567890abcdef&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;firstName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your first name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Next&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第二步表单："><a href="#第二步表单：" class="headerlink" title="第二步表单："></a>第二步表单：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/submit&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sessionId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1234567890abcdef&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Enter your last name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>sessionId</code> 在每一步表单中都作为隐藏字段传递，确保服务器能够在每一步识别用户的会话。</p>
<h4 id="示例2：防止CSRF攻击"><a href="#示例2：防止CSRF攻击" class="headerlink" title="示例2：防止CSRF攻击"></a>示例2：防止CSRF攻击</h4><p>为了防止跨站请求伪造（CSRF）攻击，可以在表单中添加一个一次性令牌（Token），并在服务器端验证该令牌。</p>
<h5 id="生成和嵌入CSRF-Token："><a href="#生成和嵌入CSRF-Token：" class="headerlink" title="生成和嵌入CSRF Token："></a>生成和嵌入CSRF Token：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/form&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FormServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 生成CSRF Token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">csrfToken</span> <span class="operator">=</span> generateCsrfToken();</span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;csrfToken&quot;</span>, csrfToken);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出表单HTML</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;html&gt;&lt;body&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;form action=&#x27;/submit&#x27; method=&#x27;post&#x27;&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;input type=&#x27;hidden&#x27; name=&#x27;csrfToken&#x27; value=&#x27;&quot;</span> + csrfToken + <span class="string">&quot;&#x27;&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;input type=&#x27;text&#x27; name=&#x27;username&#x27; placeholder=&#x27;Enter your username&#x27;&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;input type=&#x27;submit&#x27; value=&#x27;Submit&#x27;&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;/form&gt;&quot;</span>);</span><br><span class="line">        response.getWriter().println(<span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateCsrfToken</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 这里可以使用安全的方式生成随机字符串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;random-csrf-token&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="验证CSRF-Token："><a href="#验证CSRF-Token：" class="headerlink" title="验证CSRF Token："></a>验证CSRF Token：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/submit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubmitServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取并验证CSRF Token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">csrfTokenFromForm</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;csrfToken&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">csrfTokenFromSession</span> <span class="operator">=</span> (String) request.getSession().getAttribute(<span class="string">&quot;csrfToken&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (csrfTokenFromForm != <span class="literal">null</span> &amp;&amp; csrfTokenFromForm.equals(csrfTokenFromSession)) &#123;</span><br><span class="line">            <span class="comment">// CSRF Token 验证成功</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">            response.getWriter().println(<span class="string">&quot;&lt;html&gt;&lt;body&gt;&quot;</span>);</span><br><span class="line">            response.getWriter().println(<span class="string">&quot;Form submitted successfully!&quot;</span>);</span><br><span class="line">            response.getWriter().println(<span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// CSRF Token 验证失败</span></span><br><span class="line">            response.sendError(HttpServletResponse.SC_FORBIDDEN, <span class="string">&quot;Invalid CSRF token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关键点总结"><a href="#关键点总结" class="headerlink" title="关键点总结"></a>关键点总结</h3><ul>
<li><p><strong>隐藏表单域的作用</strong>：</p>
<ul>
<li><strong>传递会话ID</strong>：在不支持Cookie的情况下，通过隐藏表单域传递会话ID以维持用户的会话状态。</li>
<li><strong>状态维护</strong>：保存临时状态信息，如步骤编号、页面跳转前的状态等。</li>
<li><strong>防止CSRF攻击</strong>：通过在隐藏字段中包含一次性令牌（Token），并在服务器端进行验证，防止跨站请求伪造攻击。</li>
</ul>
</li>
<li><p><strong>如何使用隐藏表单域</strong>：</p>
<ul>
<li>使用 <code>&lt;input type=&quot;hidden&quot;&gt;</code> 标签定义隐藏字段，并设置 <code>name</code> 和 <code>value</code> 属性。</li>
<li>在表单提交时，隐藏字段的值会随其他表单数据一起发送到服务器。</li>
</ul>
</li>
<li><p><strong>安全性考虑</strong>：</p>
<ul>
<li><strong>CSRF防护</strong>：通过生成并验证一次性令牌（Token），确保表单提交的安全性。</li>
<li><strong>数据保护</strong>：虽然隐藏表单域对用户不可见，但它们仍然可以通过浏览器开发者工具查看，因此不要在隐藏字段中存储敏感信息。</li>
</ul>
</li>
</ul>
<p>通过合理使用隐藏表单域，可以在不依赖Cookie的情况下有效地管理和传递必要的会话状态和其他临时数据，同时提高应用的安全性和用户体验。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Allimac</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/02/20/WEB-3/">http://example.com/2025/02/20/WEB-3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">AllimacBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Servlet/">Servlet</a></div><div class="post-share"><div class="social-share" data-image="https://s21.ax1x.com/2025/02/20/pEQs4HJ.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/02/19/WEB-2/" title="WEB-2"><img class="cover" src="https://s21.ax1x.com/2025/02/19/pEQA3gH.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">WEB-2</div></div><div class="info-2"><div class="info-item-1">servlet容器模型</div></div></div></a><a class="pagination-related" href="/2025/02/22/WEB-4/" title="WEB-4"><img class="cover" src="https://s21.ax1x.com/2025/02/22/pElQ0Ve.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">WEB-4</div></div><div class="info-2"><div class="info-item-1">JDBC</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/02/18/WEB-1/" title="WEB-1"><img class="cover" src="https://s21.ax1x.com/2025/02/18/pEMwPWF.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-18</div><div class="info-item-2">WEB-1</div></div><div class="info-2"><div class="info-item-1">servlet入门</div></div></div></a><a class="pagination-related" href="/2025/02/19/WEB-2/" title="WEB-2"><img class="cover" src="https://s21.ax1x.com/2025/02/19/pEQA3gH.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-19</div><div class="info-item-2">WEB-2</div></div><div class="info-2"><div class="info-item-1">servlet容器模型</div></div></div></a><a class="pagination-related" href="/2025/02/22/WEB-4/" title="WEB-4"><img class="cover" src="https://s21.ax1x.com/2025/02/22/pElQ0Ve.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-22</div><div class="info-item-2">WEB-4</div></div><div class="info-2"><div class="info-item-1">JDBC</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Allimac</div><div class="author-info-description">华丽的仓库存放着我简陋的思想</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/AillemaCc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/AillemaCc" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="http://www.swindle.icu/#/Home" target="_blank" title="曾经的博客"><i class="fas fa-envelope" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">这里是小梦一场的大床</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">会话管理的概念和基本原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.</span> <span class="toc-text">简单的定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%91%A2"><span class="toc-number">1.3.</span> <span class="toc-text">怎么实现呢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E8%B7%9F%E8%B8%AA"><span class="toc-number">1.4.</span> <span class="toc-text">会话跟踪</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E7%A7%8D%E8%B7%9F%E8%B8%AA%E5%AE%A2%E6%88%B7%E7%9A%84%E7%8A%B6%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">四种跟踪客户的状态方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpSession"><span class="toc-number">2.1.</span> <span class="toc-text">HttpSession</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BB%91%E5%AE%9A%E8%BF%87%E7%A8%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">创建和绑定过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.1.2.</span> <span class="toc-text">生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">2.1.3.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.1.4.</span> <span class="toc-text">范围对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie"><span class="toc-number">2.2.</span> <span class="toc-text">Cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAcookie"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cookie%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.2.</span> <span class="toc-text">cookie结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-1"><span class="toc-number">2.2.3.</span> <span class="toc-text">生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#domain%E5%92%8Cpath"><span class="toc-number">2.2.4.</span> <span class="toc-text">domain和path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%9C%BA%E4%BE%8B%E5%AD%90"><span class="toc-number">2.2.5.</span> <span class="toc-text">一场例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#url%E9%87%8D%E5%86%99%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.</span> <span class="toc-text">url重写机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%9A%90%E8%97%8F%E7%9A%84%E8%A1%A8%E5%8D%95%E5%9F%9F"><span class="toc-number">2.4.</span> <span class="toc-text">使用隐藏的表单域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E8%A1%A8%E5%8D%95%E5%9F%9F%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.1.</span> <span class="toc-text">隐藏表单域的基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%9A%90%E8%97%8F%E8%A1%A8%E5%8D%95%E5%9F%9F%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.4.2.</span> <span class="toc-text">使用隐藏表单域的示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%EF%BC%9A%E4%BC%9A%E8%AF%9D%E8%B7%9F%E8%B8%AA"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">示例1：会话跟踪</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E8%A1%A8%E5%8D%95%EF%BC%9A"><span class="toc-number">2.4.2.1.1.</span> <span class="toc-text">第一步表单：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E8%A1%A8%E5%8D%95%EF%BC%9A"><span class="toc-number">2.4.2.1.2.</span> <span class="toc-text">第二步表单：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2%EF%BC%9A%E9%98%B2%E6%AD%A2CSRF%E6%94%BB%E5%87%BB"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">示例2：防止CSRF攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%92%8C%E5%B5%8C%E5%85%A5CSRF-Token%EF%BC%9A"><span class="toc-number">2.4.2.2.1.</span> <span class="toc-text">生成和嵌入CSRF Token：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81CSRF-Token%EF%BC%9A"><span class="toc-number">2.4.2.2.2.</span> <span class="toc-text">验证CSRF Token：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">2.4.3.</span> <span class="toc-text">关键点总结</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/03/12/NetWork-5/" title="NetWork-5"><img src="https://s21.ax1x.com/2025/03/12/pEU3ljS.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NetWork-5"/></a><div class="content"><a class="title" href="/2025/03/12/NetWork-5/" title="NetWork-5">NetWork-5</a><time datetime="2025-03-12T10:20:14.000Z" title="发表于 2025-03-12 18:20:14">2025-03-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/12/NetWork-4/" title="NetWork-4"><img src="https://s21.ax1x.com/2025/03/12/pEU3M1f.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NetWork-4"/></a><div class="content"><a class="title" href="/2025/03/12/NetWork-4/" title="NetWork-4">NetWork-4</a><time datetime="2025-03-12T10:20:01.000Z" title="发表于 2025-03-12 18:20:01">2025-03-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/12/Analysis-of-the-Source-Code-of-the-Request-Annotation/" title="Analysis-of-the-Source-Code-of-the-Request-Annotation"><img src="https://s21.ax1x.com/2025/03/12/pEU3V7d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Analysis-of-the-Source-Code-of-the-Request-Annotation"/></a><div class="content"><a class="title" href="/2025/03/12/Analysis-of-the-Source-Code-of-the-Request-Annotation/" title="Analysis-of-the-Source-Code-of-the-Request-Annotation">Analysis-of-the-Source-Code-of-the-Request-Annotation</a><time datetime="2025-03-12T10:15:41.000Z" title="发表于 2025-03-12 18:15:41">2025-03-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/03/JavaWeb-11/" title="JavaWeb-11"><img src="https://s21.ax1x.com/2025/03/03/pEGhmLj.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaWeb-11"/></a><div class="content"><a class="title" href="/2025/03/03/JavaWeb-11/" title="JavaWeb-11">JavaWeb-11</a><time datetime="2025-03-03T11:58:59.000Z" title="发表于 2025-03-03 19:58:59">2025-03-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/03/JavaWeb-10/" title="JavaWeb-10"><img src="https://s21.ax1x.com/2025/03/03/pEGhmLj.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaWeb-10"/></a><div class="content"><a class="title" href="/2025/03/03/JavaWeb-10/" title="JavaWeb-10">JavaWeb-10</a><time datetime="2025-03-03T11:44:23.000Z" title="发表于 2025-03-03 19:44:23">2025-03-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Allimac</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>